<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Penguin Daily - Breaking News</title>
  <style>
    body {
      font-family: 'Georgia', serif;
      background-color: #f5f5f5;
      color: #333;
      margin: 0;
      padding: 40px 20px;
      display: flex;
      justify-content: center;
    }

    .container {
      background: #fff;
      padding: 40px;
      max-width: 750px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border: 1px solid #ccc;
      line-height: 1.8;
    }

    h1 {
      font-size: 34px;
      text-align: center;
      margin-bottom: 15px;
      text-transform: uppercase;
      border-bottom: 2px solid #000;
      padding-bottom: 10px;
    }

    .byline {
      font-style: italic;
      font-size: 15px;
      text-align: center;
      margin-bottom: 20px;
      color: #666;
    }

    .article p {
      font-size: 18px;
      margin-bottom: 20px;
      text-align: justify;
    }

    .footer {
      margin-top: 40px;
      font-size: 14px;
      text-align: center;
      color: #999;
    }

    .loading {
      font-style: italic;
      color: #666;
      text-align: center;
    }

    /* Section for historical data */
    .history-section {
      margin-top: 60px;
      border-top: 1px solid #ccc;
      padding-top: 40px;
    }
    .history-section h2 {
      font-size: 28px;
      margin-bottom: 15px;
      text-align: center;
      text-transform: uppercase;
      border-bottom: 1px solid #000;
      padding-bottom: 10px;
    }
    .history-section p {
      font-size: 18px;
      margin-bottom: 20px;
      text-align: justify;
    }
    .history-section img {
      display: block;
      margin: 20px auto;
      max-width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .history-section ul {
      margin: 0 0 20px 20px;
      padding: 0;
      list-style-type: disc;
    }

    /* Extra content section */
    .extra-section {
      margin-top: 60px;
      border-top: 1px solid #ccc;
      padding-top: 40px;
    }
    .extra-section h2 {
      font-size: 26px;
      margin-bottom: 15px;
      text-align: center;
      text-transform: uppercase;
      border-bottom: 1px solid #000;
      padding-bottom: 10px;
    }
    .extra-section p {
      font-size: 18px;
      margin-bottom: 20px;
      text-align: justify;
    }
    .local-reaction {
      font-style: italic;
      font-size: 17px;
      margin: 20px 0;
      border-left: 3px solid #999;
      padding-left: 15px;
      color: #555;
    }
    .hotline {
      font-weight: bold;
      color: #333;
    }
  </style>

  <script>
    /* --- Generate a whimsical narrative for the daily article --- */
    function getDiscoveryNarrative() {
      const methods = [
        "was spotted casually strolling through",
        "was rescued from a fountain in",
        "was seen stealing fish from a market vendor near",
        "was found calmly riding the subway at",
        "was escorted by NYPD after being discovered exploring",
        "was spotted peeking into bakery windows near",
        "was found waddling confidently into a taxi at",
        "was caught sliding down a railing in",
        "was seen blending in with pigeons at",
        "was curiously inspecting souvenir stands in"
      ];

      const places = [
        "Central Park",
        "Times Square",
        "Wall Street",
        "Coney Island",
        "Union Square",
        "The High Line",
        "Brooklyn Bridge",
        "The Bronx Zoo",
        "Chelsea Market",
        "Fifth Avenue"
      ];

      const times = [
        "early this morning",
        "just before noon",
        "late in the afternoon",
        "as the sun set",
        "under the bright city lights"
      ];
      const weather = ["chilly", "rainy", "unexpectedly warm", "foggy", "breezy"];

      const daySeed = new Date().getDate();
      const method = methods[daySeed % methods.length];
      const place = places[daySeed % places.length];
      const timeOfDay = times[daySeed % times.length];
      const currentWeather = weather[daySeed % weather.length];

      return `On a ${currentWeather} day in New York, a penguin ${method} ${place} ${timeOfDay}, much to the amusement of passersby.`;
    }

    function getPenguinName() {
      const names = [
        "Tux",
        "Waddles",
        "Pebble",
        "Iceberg",
        "Snowball",
        "Captain Flap",
        "Pingo",
        "Feathers",
        "Blizzard",
        "Sir Slippy"
      ];
      const daySeed = new Date().getDate();
      return names[daySeed % names.length];
    }

    function getSpeciesDescription(species) {
      const descriptions = {
        "Adelie": "Adélie penguins are energetic and bold. They inhabit the Antarctic coastline and are known for their classic tuxedo appearance and social nature. Despite their small size, they’re agile swimmers and excellent hunters. These little birds can travel vast distances on land and ice, often forming large colonies during breeding season.",
        "Gentoo": "Gentoo penguins are the Formula 1 racers of the penguin world. Recognizable by the white stripe across their heads and bright orange beaks, they can swim up to 36 km/h. Gentoos are curious and clever, often seen building intricate nests with pebbles and sometimes stealing them from their neighbors.",
        "Chinstrap": "Chinstrap penguins are vocal and expressive, named for the thin black line under their beak that looks like a helmet strap. Found on rugged islands in the Southern Ocean, they live in large colonies and are constantly chatting, squawking, and waddling around with attitude. Fierce and feathery, they’re born entertainers."
      };
      return descriptions[species] || "This penguin is truly one of a kind — mysterious, elegant, and unlike any we’ve seen before. Its species remains rare in these urban adventures.";
    }

    /* --- Random fun fact about penguins --- */
    function getRandomFunFact() {
      const funFacts = [
        "Penguins can drink saltwater because a special gland filters excess salt from their bloodstream.",
        "A group of penguins on land is called a waddle, while a group of penguins in the water is called a raft.",
        "Some penguin species can leap up to six feet out of the water onto ice or land.",
        "Penguins have knees hidden under their feathers — their legs are longer than they look!",
        "The fastest penguin is the Gentoo, which can swim up to 36 km/h (22 mph)."
      ];
      return funFacts[Math.floor(Math.random() * funFacts.length)];
    }

    /* --- Random local reaction from a fictional NYC resident --- */
    function getLocalReaction() {
      const reactions = [
        "“I thought I was hallucinating until it honked at me!”",
        "“First I saw a rat the size of a cat, now a penguin in Times Square? Only in New York!”",
        "“It waddled right up to me like it wanted a bagel. So I gave it one.”",
        "“If this penguin can handle the F train, it’s definitely a true New Yorker.”",
        "“It looked so dapper, I almost asked if it had tickets to the Broadway show!”"
      ];
      return reactions[Math.floor(Math.random() * reactions.length)];
    }

    /* --- Fetch and display the latest prediction article --- */
    async function loadPrediction() {
      try {
        const response = await fetch('data/prediction_result.json');
        const data = await response.json();

        const discovery = getDiscoveryNarrative();
        const speciesText = getSpeciesDescription(data.predicted_species);
        const penguinName = getPenguinName();

        // Round numbers to 2 decimal places
        const billLength = parseFloat(data.bill_length_mm || 0).toFixed(2);
        const billDepth = parseFloat(data.bill_depth_mm || 0).toFixed(2);
        const flipperLength = parseFloat(data.flipper_length_mm || 0).toFixed(2);

        document.getElementById("prediction").innerHTML = `
          <h1>Penguin Found in New York!</h1>
          <div class="byline">Penguin Daily • ${new Date(data.timestamp).toLocaleDateString()}</div>
          <div class="article">
            <p>${discovery}</p>
            <p>The bird was later identified as a ${data.predicted_species}, based on detailed measurements of its bill and flippers. Wildlife experts confirmed the following: a bill length of ${billLength}mm, a bill depth of ${billDepth}mm, and flipper length measuring ${flipperLength}mm.</p>
            <p>${speciesText}</p>
            <p>Authorities continue to investigate how these Antarctic visitors keep appearing in the heart of the Big Apple. Locals, meanwhile, have affectionately named the penguin "${penguinName}", and many are already petitioning for an official welcome parade.</p>
          </div>
          <div class="footer">Copyright © Penguin Daily</div>
        `;
      } catch (error) {
        document.getElementById("prediction").innerHTML = "<p class='loading'>Failed to load prediction article.</p>";
      }
    }

    /* --- Fetch and display the historical data & pie chart --- */
    async function loadHistory() {
      try {
        const response = await fetch('data/prediction_history.json');
        const history = await response.json();

        // If there's no history yet, just show a note
        if (!Array.isArray(history) || history.length === 0) {
          document.getElementById('history-section').innerHTML = `
            <h2>Historical Penguin Predictions</h2>
            <p>No historical data available yet. Stay tuned!</p>
          `;
          return;
        }

        // Find earliest date in the history
        const earliestTimestamp = history
          .map(h => new Date(h.timestamp))
          .reduce((a, b) => a < b ? a : b); // min date
        const earliestDateStr = earliestTimestamp.toLocaleDateString();

        // Count how many predictions total
        const totalCount = history.length;

        // Count how many of each species
        const speciesCounts = {};
        history.forEach(item => {
          const sp = item.predicted_species;
          speciesCounts[sp] = (speciesCounts[sp] || 0) + 1;
        });

        // Build an HTML snippet listing species and their counts
        let speciesCountsHTML = `<p>So far, we have encountered the following species in total:</p><ul>`;
        for (const [sp, count] of Object.entries(speciesCounts)) {
          speciesCountsHTML += `<li><strong>${sp}:</strong> ${count}</li>`;
        }
        speciesCountsHTML += `</ul>`;

        // Display the historical overview
        document.getElementById('history-section').innerHTML = `
          <h2>Historical Penguin Predictions</h2>
          <p>We started tracking penguin appearances in New York on <strong>${earliestDateStr}</strong>. 
          Since then, we have recorded <strong>${totalCount}</strong> penguins. 
          The chart below shows the distribution of the predicted species so far. 
          As more penguins are spotted, these numbers may change.</p>

          <img src="data/species_distribution.png" alt="Penguin Species Distribution"/>

          ${speciesCountsHTML}

          <p>It's fascinating to see how many Gentoos, Adélies, and Chinstraps have turned up in unexpected places across the city. 
          Rumors are swirling that an Antarctic tourism operator may be sneaking these flightless travelers into the Big Apple—possibly 
          to enjoy our unique culinary scene or vibrant nightlife. We’ll keep updating this chart and bring you the latest (and cutest) 
          penguin news as it unfolds!</p>
        `;
      } catch (error) {
        document.getElementById('history-section').innerHTML = `
          <h2>Historical Penguin Predictions</h2>
          <p class='loading'>Failed to load historical data.</p>
        `;
      }
    }

    /* --- Display extra content: Fun Fact & Local Reaction --- */
    function loadExtraFeatures() {
      const funFact = getRandomFunFact();
      const localQuote = getLocalReaction();

      document.getElementById('extra-section').innerHTML = `
        <h2>Penguin Fun Fact & Local Reaction</h2>
        <p><strong>Fun Fact:</strong> ${funFact}</p>
        <div class="local-reaction">
          <strong>Local Reaction:</strong> ${localQuote}
        </div>
        <p>If you happen to spot any wandering penguins, please call our <span class="hotline">Penguin Hotline at 1-800-PENGUIN</span> or email <em>sightings@penguindaily.com</em>. Your tip could be the next big story!</p>
      `;
    }

    /* --- On page load, fetch both the latest prediction and the historical data, plus extras --- */
    window.onload = function() {
      loadPrediction();
      loadHistory();
      loadExtraFeatures();
    };
  </script>
</head>
<body>
  <div class="container">
    <!-- Latest single prediction/article goes here -->
    <div id="prediction" class="loading">Loading article...</div>

    <!-- Historical data and pie chart go here -->
    <div id="history-section" class="history-section"></div>

    <!-- Extra content: fun fact, local reaction, hotline -->
    <div id="extra-section" class="extra-section"></div>
  </div>
</body>
</html>
